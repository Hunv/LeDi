@page "/tournamentmatchlist/{Id:int}"
@using LeDi.Server2.DatabaseModel;
@using Microsoft.AspNetCore.Authorization;
@using Microsoft.AspNetCore.Identity;
@inject UserManager<IdentityUser> _UserManager
@inject RoleManager<IdentityRole> _RoleManager
@inject AuthenticationStateProvider AuthenticationStateProvider
@inject Microsoft.Extensions.Localization.IStringLocalizer<TournamentMatchlist> Localizer

<h3>@Localizer["TournamentMatchlist"]</h3>



@if (Tournament == null)
{
    <p><em>@Localizer["Loading"]</em></p>
}
else
{
    <AuthorizeView Roles="Att-CanTournamentAdd,Att-CanTournamentEdit,Att-CanTournamentMatchAdd,Att-CanTournamentMatchDelete,Att-CanTournamentMatchDelete">
        <Authorized>
            <table class="table table-striped table-hover table-responsive-sm">
                <thead>
                    <tr>
                        <th>@Localizer["Team1Name"]</th>
                        <th>@Localizer["Team2Name"]</th>
                        <th>@Localizer["Status"]</th>
                        <th>@Localizer["Score"]</th>
                        <th class="d-none d-lg-table-cell">@Localizer["ScheduledTime"]</th>
                        <th></th>
                        <th></th>
                    </tr>
                </thead>
                <tbody>
                    @foreach (var match in Tournament.Matches)
                    {
                        <tr class="align-middle">
                            <td>
                                @match.Team1Name
                            </td>
                            <td>
                                @match.Team2Name
                            </td>
                            <td>
                                @switch (match.MatchStatus)
                                {
                                    case 0: 
                                        @Localizer["Unknown"]
                                        break;
                                    case 10:
                                        @Localizer["Planned"]
                                        break;
                                    case 20:
                                        @Localizer["ReadyToStart"]
                                        break;
                                    case 30:
                                        @Localizer["Running"]
                                        break;
                                    case 39:
                                        @Localizer["PeriodEnded"]
                                        break;
                                    case 40:
                                        @Localizer["Ended"]
                                        break;
                                    case 100:
                                        @Localizer["Closed"]
                                        break;
                                    case 200:
                                        @Localizer["Canceled"]
                                        break;
                                    case 210:
                                        @Localizer["Stopped"]
                                        break;
                                    default:
                                        @match.MatchStatus
                                        break;
                                }
                            </td>
                            <td>
                                @match.Team1Score:@match.Team2Score
                            </td>
                            <td class="d-none d-lg-table-cell">
                                @match.ScheduledTime
                            </td>
                            <td>
                                <a href="/matchcontrol/@match.Id" class="btn btn-primary"><span class="oi oi-target" aria-hidden="true"></span> @Localizer["Referee"]</a>
                            </td>
                            <td>
                                <AuthorizeView Roles="Att-CanTournamentMatchEdit,Att-IsAdmin" Context="y">
                                    <Authorized>
                                        <a href="/match/@match.Id?returnurl=/tournamentmatchlist/@Tournament.Id" class="btn btn-secondary"><span class="oi oi-pencil" aria-hidden="true"></span> @Localizer["Edit"]</a>
                                    </Authorized>
                                </AuthorizeView>
                            </td>
                        </tr>
                    }
                </tbody>
            </table>

            <br />
            <br />
            
            <AuthorizeView Roles="Att-CanTournamentMatchAdd,Att-IsAdmin" Context="y">
                <Authorized>
                    <a class="btn btn-primary" href="/matchadd?tournamentid=@Tournament.Id&returnurl=/tournamentmatchlist/@Tournament.Id" role="button">@Localizer["AddMatch"]</a>
                </Authorized>
            </AuthorizeView>
        </Authorized>
        <NotAuthorized>
            <p>@Localizer["NoPermissions"]</p>
        </NotAuthorized>
    </AuthorizeView>
}