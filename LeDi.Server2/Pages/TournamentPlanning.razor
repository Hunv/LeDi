@page "/tournamentplanning"
@using LeDi.Server2.DatabaseModel;
@using Microsoft.AspNetCore.Authorization;
@using Microsoft.AspNetCore.Identity;
@inject UserManager<IdentityUser> _UserManager
@inject RoleManager<IdentityRole> _RoleManager
@inject AuthenticationStateProvider AuthenticationStateProvider
@inject NavigationManager NavigationManager
@inject Microsoft.Extensions.Localization.IStringLocalizer<TournamentPlanning> Localizer

<h3>@Localizer["TournamentPlanning"]</h3>


@if (TournamentList == null)
{
    <p><em>@Localizer["Loading"]</em></p>
}
else
{
    <AuthorizeView Roles="Att-CanTournamentAdd,Att-CanTournamentEdit,Att-CanTournamentMatchAdd,Att-CanTournamentMatchDelete,Att-CanTournamentMatchDelete,Att-IsAdmin">
        <Authorized>
            <br />
            <h4>@Localizer["CurrentOrPlanedTournaments"]</h4>
            <br />

            <div class="container-fluid">
                @foreach (var tournament in TournamentList.Where(x => x.EndDate >= DateTime.Today).OrderBy(x => x.StartDate))
                {
                    <Card>
                        <HeaderTemplate>
                            <h5>@tournament.Name</h5>
                        </HeaderTemplate>
                        <BodyTemplate>

                            <a href="/tournamentmatchlist/@tournament.Id" class="fs-4"><i class="fas fa-arrow-right" aria-hidden="true"></i> @Localizer["GoToMatchlist"]</a><br /><br />

                            <table class="table table-borderless table-sm">
                                <tbody>
                                    <tr>
                                        <td>
                                            @Localizer["TournamentStartDate"]
                                        </td>
                                        <td>
                                            @tournament.StartDate
                                        </td>
                                    </tr>
                                    <tr>
                                        <td>
                                            @Localizer["TournamentEndDate"]
                                        </td>
                                        <td>
                                            @tournament.EndDate
                                        </td>
                                </tr>
                                <tr>
                                    <td>
                                        @Localizer["NumberOfMatches"]
                                    </td>
                                    <td>
                                        @tournament.Matches.Count()
                                    </td>
                                </tr>
                                    <tr>
                                        <td>
                                            @Localizer["NumberOfTeams"]
                                        </td>
                                        <td>
                                            todo <br />
                                            Participating Teams: todo
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </BodyTemplate>
                        <FooterTemplate>
                            <AuthorizeView Roles="Att-CanTournamentMatchAdd,Att-IsAdmin" Context="y">
                                <Authorized>
                                    <Tooltip Title="@Localizer["AddMatch"]" Placement="Placement.Bottom">
                                        <a href="/matchadd?tournamentid=@tournament.Id&returnurl=/tournamentplanning" class="fs-1">
                                            <i class="fa-solid fa-plus" aria-hidden="true"></i>
                                        </a>&nbsp;&nbsp;
                                    </Tooltip>
                                </Authorized>
                            </AuthorizeView>
                            @if (EventTournamentId != tournament.Id.ToString())
                            {
                                <AuthorizeView Roles="Att-CanTournamentAdd,Att-IsAdmin" Context="y">
                                    <Authorized>
                                        <Tooltip Title="@Localizer["StartTournament"]" Placement="Placement.Bottom" @onclick="@(() => StartTournament(tournament.Id))">
                                            <a style="color:#0d6efd" class="fs-1">
                                                <i class="fa-solid fa-play" aria-hidden="true"></i>
                                            </a>&nbsp;&nbsp;
                                        </Tooltip>
                                    </Authorized>
                                </AuthorizeView>
                            }
                            else
                            {
                                <AuthorizeView Roles="Att-CanTournamentAdd,Att-IsAdmin" Context="y">
                                    <Authorized>
                                        <Tooltip Title="@Localizer["StopTournament"]" Placement="Placement.Bottom" @onclick="StopTournament">
                                            <a style="color:#0d6efd" class="fs-1">
                                                <i class="fa-solid fa-stop" aria-hidden="true"></i>
                                            </a>&nbsp;&nbsp;
                                        </Tooltip>
                                    </Authorized>
                                </AuthorizeView>
                            }
                            <AuthorizeView Roles="Att-CanTournamentEdit,Att-IsAdmin" Context="y">
                                <Authorized>
                                    <Tooltip Title="@Localizer["Edit"]" Placement="Placement.Bottom">
                                        <a href="/tournamentadd/@tournament.Id" class="fs-1">
                                            <i class="fa-solid fa-pencil" aria-hidden="true"></i>
                                        </a>&nbsp;&nbsp;
                                    </Tooltip>
                                </Authorized>
                            </AuthorizeView>
                        </FooterTemplate>
                    </Card>
                    <br />
                }
            </div>

            <AuthorizeView Roles="Att-CanTournamentAdd,Att-IsAdmin" Context="y">
                <Authorized>
                    <a class="btn btn-primary oi oi-medical-cross" href="tournamentadd" role="button">Create Tournament</a>
                </Authorized>
            </AuthorizeView>

            <br /> <br />

            <h4>@Localizer["FinishedTournaments"]</h4>
            <table class="table">
                <thead>
                    <tr>
                        <th>@Localizer["TournamentName"]</th>
                        <th>@Localizer["TournamentStartDate"]</th>
                        <th>@Localizer["TournamentEndDate"]</th>
                        <th>@Localizer["NumberOfTeams"]</th>
                        <th>@Localizer["NumberOfMatches"]</th>
                        <th></th>
                    </tr>
                </thead>
                <tbody>
                    @foreach (var tournament in TournamentList)
                    {
                        <tr>
                            <td>
                                @tournament.Name
                            </td>
                            <td>
                                @tournament.StartDate
                            </td>
                            <td>
                                @tournament.EndDate
                            </td>
                            <td>todo</td>
                            <td>@tournament.Matches.Count()</td>
                            <td></td>
                        </tr>
                    }
                </tbody>
            </table>
        </Authorized>
        <NotAuthorized>
            <p>@Localizer["NoPermissions"]</p>
        </NotAuthorized>
    </AuthorizeView>
}